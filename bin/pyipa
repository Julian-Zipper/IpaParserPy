#!/usr/bin/env python

"""pyipa.

Usage:
  pyipa [-k --keys=<comma_list>] [-o --out=<json>] [--icons] IPA [FILE]
  pyipa (-h | --help)
  pyipa --version

Options:
  -k --keys=<comma_list> Keys to extracts in a comma separated list [default: CFBundleDisplayName,CFBundleIdentifier,CFBundleVersion]
  -o --out=<json>     Type of output can be json,text [default: json]
  --icons             Extract icons in calling dir
  -h --help           Show this screen.
  --version           Show version.
"""
from docopt import docopt
from pyipa import IPAparser
import pprint
import json

DEFAULT_KEYS = ['CFBundleDisplayName', 'CFBundleIdentifier', 'CFBundleVersion']

if __name__ == '__main__':
  arguments = docopt(__doc__, version='Asd', options_first=True)

  ipa = IPAparser(arguments['IPA'])
  InfoPlist = ipa.parseInfo()

  pp = pprint.PrettyPrinter(indent=1)

  #pp.pprint(arguments)

  key_filter = DEFAULT_KEYS
  if arguments['--keys']:
    key_filter = arguments['--keys']

  d = dict((k, v) for k, v in InfoPlist.items() if k in key_filter)
  if arguments['--out'] == 'json':
    out = json.dumps(d, indent=2)

  if arguments['FILE']:
    print "on file"
  else:
    print out

